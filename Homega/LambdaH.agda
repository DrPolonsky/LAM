{-# OPTIONS --guardedness #-}
module Homega.LambdaH where

-- Basic lambda calculus
open import Logic
open import Lifting
open import Lambda
open import Reduction
-- unsolvables
open import Homega.Unsolvable
-- subsets, n-ary relations, and logical operations on them
open import Predicates
-- reflexive/symmetric/transitive closures, equivalence relations
open import Relations.ClosureOperators

-- Beta-Omega conversion is the equivalence relation
-- generated by the union of âŸ¶Î² and =Î©
_=Î²Î©_ : Î›Rel
_=Î²Î©_ = (_âŸ¶Î²_ âˆª _=Î©_) â¼

record _=ğ“—_ {X : Set} (s t : Î› X) : Set where
  constructor ğ“—eq
  field
    lterm : Î› X
    rterm : Î› X
    lsred : s âŸ¶s lterm
    rpred : t â‡‰â‹† rterm
    l=Î©r : lterm =Î© rterm

reflğ“— : âˆ€ {X} {t : Î› X} â†’ t =ğ“— t
reflğ“— {X} {t} = ğ“—eq t t reflâŸ¶s Îµâ‹† refl=Î©

âŸ¶Î²!=ğ“— : âˆ€ {X} {r s t : Î› X} â†’ r âŸ¶Î² s â†’ s =ğ“— t â†’ r =ğ“— t
âŸ¶Î²!=ğ“— {X} {r} {s} {t} rs (ğ“—eq lterm rterm lsred rpred l=Î©r)
  = ğ“—eq lterm rterm (âŸ¶Î²â‹†!âŸ¶sâŠ†âŸ¶s (rs ,â‹† Îµâ‹†) lsred) rpred l=Î©r

âŸ¶Î²~!=ğ“— : âˆ€ {X} {r s t : Î› X} â†’ s âŸ¶Î² r â†’ s =ğ“— t â†’ r =ğ“— t
âŸ¶Î²~!=ğ“— {X} {r} {s} {t} sr (ğ“—eq lterm rterm lsred rpred l=Î©r)
  with âŸ¶s\â‡‰ lsred (âŸ¶Î²âŠ†â‡‰ sr)
... | u ,, lu , ru with â‡‰\=Î© lu l=Î©r
... | v ,, uv , rv = ğ“—eq u v ru (rpred â‹†!â‹† (rv ,â‹† Îµâ‹†) ) uv

=Î©!=ğ“— : âˆ€ {X} {r s t : Î› X} â†’ r =Î© s â†’ s =ğ“— t â†’ r =ğ“— t
=Î©!=ğ“— rs (ğ“—eq lterm rterm lsred rpred l=Î©r) with =Î©/âŸ¶s rs lsred
... | (u ,, ru , u=l) = ğ“—eq u rterm ru rpred (u=l =Î©!=Î© l=Î©r)

-- Standardization Theorem for ğ“—
=Î²Î©âŠ†ğ“— : âˆ€ {X} {s t : Î› X} â†’ (s =Î²Î© t) â†’ (s =ğ“— t)
=Î²Î©âŠ†ğ“— Îµâ‹† = reflğ“—
=Î²Î©âŠ†ğ“— {s = s} {t} (axË¢+ (in1 sâ†’y) ,â‹† st) = âŸ¶Î²!=ğ“— sâ†’y (=Î²Î©âŠ†ğ“— st)
=Î²Î©âŠ†ğ“— {s = s} {t} (axË¢+ (in2 s=y) ,â‹† st) = =Î©!=ğ“— s=y (=Î²Î©âŠ†ğ“— st)
=Î²Î©âŠ†ğ“— {s = s} {t} (axË¢- (in1 yâ†’s) ,â‹† st) = âŸ¶Î²~!=ğ“— yâ†’s (=Î²Î©âŠ†ğ“— st)
=Î²Î©âŠ†ğ“— {s = s} {t} (axË¢- (in2 y=s) ,â‹† st) = =Î©!=ğ“— (~=Î© y=s) (=Î²Î©âŠ†ğ“— st)

absâ‡‰â‹† : âˆ€ {X} {r1 r2 : Î› (â†‘ X)} â†’ r1 â‡‰â‹† r2 â†’ abs r1 â‡‰â‹† abs r2
absâ‡‰â‹† Îµâ‹† = Îµâ‹†
absâ‡‰â‹† (x ,â‹† r12) = absâ‡‰ x ,â‹† absâ‡‰â‹† r12

-- Additional Lemmas for use later
absğ“— : âˆ€ {X} {r1 r2 : Î› (â†‘ X)} â†’ r1 =ğ“— r2 â†’ abs r1 =ğ“— abs r2
absğ“— (ğ“—eq lterm rterm lsred rpred l=Î©r)
  = ğ“—eq (abs lterm) (abs rterm) (absâŸ¶s lsred ) (absâ‡‰â‹† rpred ) (absÎ© l=Î©r )

_ğ“—[_] : âˆ€ {X Y} {s t : Î› X} â†’ s =ğ“— t â†’ âˆ€ (Ïƒ : X â†’ Î› Y) â†’ (s [ Ïƒ ]) =ğ“— (t [ Ïƒ ])
_ğ“—[_] (ğ“—eq lterm rterm lsred rpred l=Î©r)  Ïƒ =
  ğ“—eq (lterm [ Ïƒ ]) (rterm [ Ïƒ ])
        (âŸ¶s[âŸ¶s] Ïƒ Ïƒ (Î» x â†’ reflâŸ¶s) lsred )
        (rpred â‡‰â‹†[ Ïƒ ])
        (=Î©[=Î©] Ïƒ Ïƒ (Î» x â†’ refl=Î©) l=Î©r )

appğ“— : âˆ€ {X} {s1 s2 t1 t2 : Î› X} â†’ s1 =ğ“— s2 â†’ t1 =ğ“— t2 â†’ app s1 t1 =ğ“— app s2 t2
appğ“— (ğ“—eq l1 r1 ls1 rp1 l1=Î©r1) (ğ“—eq l2 r2 ls2 rp2 l2=Î©r2) =
  ğ“—eq (app l1 l2) (app r1 r2) (appâŸ¶s ls1 ls2) (appâ‡‰â‹† rp1 rp2 ) (appÎ© l1=Î©r1 l2=Î©r2 )

symmğ“— : âˆ€ {X} {s t : Î› X} â†’ s =ğ“— t â†’ t =ğ“— s
symmğ“— (ğ“—eq lterm rterm lsred rpred l=Î©r) = ğ“—eq rterm lterm l r e
  where l = âŸ¶Î²â‹†âŠ†âŸ¶s (â‡‰â‹†âŠ†âŸ¶Î²â‹† rpred )
        r = âŸ¶Î²â‹†âŠ†â‡‰â‹† (âŸ¶sâŠ†âŸ¶Î²â‹† _ _ lsred)
        e = ~=Î© l=Î©r
-- The end
