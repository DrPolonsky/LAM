\section{Definitions}
\label{sec:Definitions}
The following definitions are provided to ensure clarity and precision
in our discussion. Each subsection specifies the Agda file(s) which contains formalizations of the given definitions.
%All the files in this section are found in the \texttt{Relations} folder.

\begin{definition}
    An \bemph{abstract rewrite system ({ARS})} is a structure $\mathcal{A} = (A, R_\alpha)$ where
     $A$ is a set and $R_\alpha$ is a set of binary relations on $A$.
\end{definition}

For the rest of this paper, let $A$ be a fixed set, $R$ be a relation on $A$.


% \greyout{We denote by $\tilde R$ the relational converse of $R$ ($(x,y) \in \tilde R \iff (y,x) \in R$),
% and by $R;R'$ the relational composition of $R$ and $R'$.}

\subsection{Closure operators (\texttt{Relations/ClosureOperators.agda})}

\begin{notation}
The following notations are standard.
  \begin{enumerate}
    \item $R^r$ denotes the \bemph{reflexive closure} of $R$.
    \item $R^s$ denotes the \bemph{symmetric closure} of $R$.
    \item $\tclos{R}$ denotes the \bemph{transitive closure} of $R$.
    \item $R^* = (R^r)\tclos{}$ denotes the \bemph{reflexive--transitive closure} of $R$.
    \item $R^= = (R^s)^*$ denotes the \bemph{equivalence relation generated by} $R$.
  \end{enumerate}
\end{notation}

In the context of abstract rewriting, we will often write $a \rstep b$
in place of $(a,b) \in R$.  We will also write $a \mstep b$ for $(a,b) \in R^*$, and
$a \bstep b$ for $(b,a) \in R$.  When the relation $R$ is clear from the context,
we may drop the corresponding subscript.

The file \texttt{ClosureOperators.agda} verifies key properties of closure operators
on relations, including their monotonicity, preservation of equivalence, and interactions such as inclusions and equivalences between different closures.

\subsection{Normalization and Confluence (\texttt{ARS/Properties.agda})}

We define rewriting-theoretic concepts such as confluence and normalization as predicates on $A$, specifying when a given element $a \in A$ satisfies a property locally. Universal quantification over $a$ then yields the corresponding global property of the relation $R$

% \subsection{Normalization (\texttt{Properties.agda})}
\begin{definition} Let $a \in A$.
  \begin{description}
    \item[\bq \ule{${a \in \NF_R}$}] $a$ is a \bemph{normal form} if $(a,b) \notin R$ for any $b \in A$ .
    \item[\bq \ule{$a \in \WN_R$}] $a$ is \bemph{weakly normalizing} if $a \mstep b$ for some $b \in \NF_R$.
    \item[\bq \ule{$a \in \SN_R$}] $a$ is \bemph{strongly normalizing} if $a$ is accessible with respect to the converse relation $\tilde{R} = \setof{(y,x) | (x,y) \in R}$.
    See Section \ref{sec:Well-foundedness} for the notion of accessibility.
  \end{description}
\end{definition}

% \subsection{Confluence (\texttt{Properties.agda})}
\begin{definition} Let $a \in A$.
    \begin{description}
        \item[\bq \ule{$a \in \WCR_R$}] $a$ is \bemph{weakly Church-Rosser} (or \emph{weakly confluent}) if for all $b,c \in A$, \[c \bstep a \rstep b \implies \exists d.\, c \mstep d \bmstep b\]
        \item[\bq \ule{$a \in \CR_R$}] $a$ is \bemph{Church-Rosser} (or \emph{confluent}) if for all $b,c \in A$, \[c \bmstep a \mstep b \implies \exists d.\, c \mstep d \bmstep b\]
        \item[\bq \ule{$a \in \CRs_R$}] $a$ is \bemph{subcommutative} if for all $b, c \in A$,
        \[c \bmstep a \mstep b \implies \exists d. \, c \rrstep d \brstep b\]
        \item[\bq \ule{$a \in \NPe_R$}] $a$ has the \bemph{conversion normal form property} if for all $b \in \NF_R$, \[ a \estep b \implies a\mstep b\]
        \item[\bq \ule{$a \in \NP_R$}] $a$ has the \bemph{reduction normal form property} if for all $b \in \NF_R$,
        \[c \bmstep a \mstep b \implies c \mstep b\]
        \item[\bq \ule{$a \in \UN_R$}] $a$ has the \bemph{conversion unique normal form property} if for all $a, b \in \NF_R$, \[a \estep b \implies a \equiv b\]
        \item[\bq \ule{$a \in \UNto_R$}] $a$ has the \bemph{reduction unique normal form property} if for all $b, c \in \NF_R$,
        \[c \bmstep a \mstep b  \implies b \equiv c\]
    \end{description}
\end{definition}
% \begin{definition} Let $a \in A$.
%     \begin{description}
%         \item[\ule{$a \in \WCR_R$}] \bemph{$a$ is weakly Church-Rosser (or weakly confluent)} if $c \bstep a \rstep b \implies c \mstep d \bmstep b$.
%         \item[\ule{$a \in \CR_R$}] \bemph{$a$ is Church-Rosser (or confluent)} if $c \bmstep a \mstep b \implies c \mstep d \bmstep b$.
%         \item[\ule{$a \in \CRs_R$}] \bemph{$a$ is subcommutative} if $c \bmstep a \mstep b \implies c \rrstep d \brstep b$.
%         \item[\ule{$a \in \NPe_R$}] \bemph{$a$ has the conversion normal form property} if $a \estep b \implies a\mstep b$ for any $b \in \NF$.
%         \item[\ule{$a \in \NP_R$}] \bemph{$a$ has the normal form property} if $c \bmstep a \mstep b \implies c \mstep b$ for any $b \in \NF$.
%         \item[\ule{$a \in \UN_R$}] \bemph{$a$ has the unique normal form property} if $a \estep b \implies a \equiv b$  for any $a, b \in \NF$.
%         \item[\ule{$a \in \UNto_R$}] \bemph{$a$ has the unique normal form property with respect to reduction} if $c \bmstep a \mstep b  \implies b \equiv c$  for any $b, c \in \NF$.
%     \end{description}
% \end{definition}

\begin{notation}
    For each of the predicates $\mathrm{X_R}$ defined above we write
    $\mathbf{X}(R)$ if $\forall a.\; a \in \mathrm{X}_R$. When $R$ is implied by the context, we will write $\gNP$ for $\gNP(R)$, etc.

    That is, for $\mathrm{X} \in \{\WCR , \CR , \NP , \UN, \dots \}$, $\mathbf{X}$ denotes the statement $\forall a. a \in \mathrm{X}_R$.
\end{notation}


In \terese $\,\NF$ is used to denote the normal form property $\NPe$, whereas we have chosen to use $\NF$ to denote the set of normal forms.

\begin{proposition}\hfill
    \begin{enumerate}
        \item $\gNPe \iff \gNP$
        \item $\gUN \, \implies \gUNto$
    \end{enumerate}
\end{proposition}
  All of the proofs in this work have been fully formalized in Agda, and many of them require no further elaboration.  Throughout the paper, we refer to the relevant locations in the code base by giving the name of the Agda file, along with the names and types of the functions corresponding to each claim.

The proof of the above proposition is formalized in \texttt{ARS/Implications.agda} as follows.
    \begin{enumerate}
        \item \verb|NP₌↔NP : R isNP₌ ↔ R isNP|
        \item \verb|UN→|\texttt{UN}$^{\to}$\verb|: R isUN → R is|\texttt{UN}$^{\to}$ \qedhere
    \end{enumerate}

\begin{remark}
    The implication $\UNto \implies \UN$ does not hold, as can be seen in Counterexample~\ref{CE:5} in Figure~\ref{fig:counterexamples}.
\end{remark}

\subsection{Sequences and Recurrence (\texttt{Relations/Seq.agda}, \texttt{ARS/Properties.agda})}
% The following definitions are key to formalizing Theorem 1.2.3 in \terese.
The definitions in this subsection are key to formalizing Theorem 1.2.3 in \terese.

\begin{definition} \label{def:seq} \hfill
  \begin{description}
    \item \bq A \bemph{sequence} is a function $s$ from the natural numbers to $A$.
    \item \bq A sequence $s : \nat \to A$ is \bemph{$R$-decreasing} if every element of the sequence is $R$-related to its preceding term: $\forall k. s(k+1) \rstep sk$.
    \item \bq A sequence $s : \nat \to A$ is \bemph{$R$-increasing} if every element of the sequence is $R$-related to its succeeding term: $\forall k. sk \rstep s(k+1)$.
  \end{description}
\end{definition}

\begin{definition}\hfill
    \begin{description}
        \item[\bq \ule{$x \in CP_R$}] $x$ has the \bemph{cofinality property} if there exists an $R^r$-increasing sequence
        \mbox{$s : \nat {\to} A$} starting from $x$ such that every
        reduct of $x$ reduces to some element of the sequence.
        \[ x \mstep y \implies \exists i. y \mstep s(i) \]
        % \item[\ule{$x \in CP_R$}] \bemph{$x$ has the cofinality property} if there exists an
        % (not necessarily strictly) increasing sequence starting from $x$ such that every
        % reduct of $x$ reduces to some element of the sequence.
    \end{description}
\end{definition}

\begin{definition} \label{def:bound} \hfill
  \begin{itemize}
    \item $a \in A$ is an \bemph{$s$-bound} if for all $i \in \nat$, $s (i) \mstep a$.
    \item $s : \nat \to A$ is \bemph{bounded} if there exists $a \in A$ that is an $s$-bound.
  \end{itemize}
\end{definition}

\begin{definition} \label{def:rp}
  The following are global properties of the given relation $R$.  \hfill
    \begin{description}
        \item[\bq \ule{$\gBP(R)$}] $R$ has the \bemph{boundedness property} if every $R$-increasing sequence is bounded.
        \item[\bq \ule{$\gRP(R)$}] $R$ has the \bemph{recurrence property} if for every bounded, increasing sequence $s$ with an $s$-bound, there exists an $i \in \nat$ such that
        $s (i) \mstep x \implies x \mstep s (i)$ for all $x\in A$.
        \item[\bq \ule{$\gRPm(R)$}] $R$ has the \bemph{weak recurrence property} if for every increasing sequence $s$ with bound $b$ there exists an $i \in \nat$ such that $b \mstep s (i)$.
    \end{description}
\end{definition}

The property $\gBP$ is equivalent to the property called $\mathbf{Ind}$ in \terese. More precisely, $\mathbf{Ind}$ asserts the existence of a bound for finite sequences as well, but that is automatic, since the last term of a finite reduction sequence is a bound for that sequence.

\terese $\,$ also defines the following property, which is not included in our formalization.

\begin{definition} \hfill
    \begin{description}
        \item[\bq  \ule{$\gInc(R)$}] $R$ is \bemph{increasing} if there exists a ``size function'' $|{-}| : A \to \nat$ satisfying, for all $a, b \in A$,
        $(a \rstep b) \implies |a| < |b|$.
    \end{description}
\end{definition}

Having a size function that maps all of $A$ to the natural numbers can be computationally taxing to satisfy.
Furthermore, it takes us outside of a purely relational theory. The weaker property $\gRP$ defined above will substitute $\gInc$ in all places that require it. For further discussion, see Subsection~\ref{subsec:def}.

\begin{proposition}\hfill
    \begin{enumerate}
        \item $\gInc \implies \gRP$
        \item $\gRP \iff \gRPm$
    \end{enumerate}
\end{proposition}

\begin{proof} \hfill
    \begin{enumerate}
        \item $\gInc$ implies that there are no bounded $R$-increasing sequences,
        so $\gRP$ holds vacuously.
        \item See \verb|RP-↔RP : R isRP- ↔ R isRP| in \texttt{ARS/Implications.agda}. \qedhere
    \end{enumerate}
\end{proof}

\subsection{Finitely branching (\texttt{Relations/FinitelyBranching.agda})}

\begin{definition} \hfill
    \begin{description}
        \item[\bq \ule{$a \in \FB$}] $a$ is \bemph{finitely branching} if there are finitely many $b \in A$ such that $a \rstep b$.
    \end{description}
\end{definition}

Our Agda formulation of the above definition makes use of the List type constructor, which we import from the Agda Standard Library \cite{AgdaLibraryList}.


\verb|FB a = Σ[ xs ∈ List A ] (∀ b → R b a → b ∈List xs)|

$\FB$ plays an important role in our discussion of well-foundedness, see Section \ref{sec:Well-foundedness}.
