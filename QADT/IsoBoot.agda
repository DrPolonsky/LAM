{-# OPTIONS --type-in-type #-}

open import Logic
open import Lifting
open import Datatypes
open import Predicates using (ğ“Ÿ)
open import Relations.Core using (Rel)

-- Bootstrapping isomorphisms
module QADT.IsoBoot where

data ğ•Œ (V : Set) : Set where
  ğ•âˆ™ : V â†’ ğ•Œ V
  âŠ¥âˆ™ : ğ•Œ V
  âŠ¤âˆ™ : ğ•Œ V
  Ã—âˆ™ : ğ•Œ V â†’ ğ•Œ V â†’ ğ•Œ V
  âŠ”âˆ™ : ğ•Œ V â†’ ğ•Œ V â†’ ğ•Œ V
  Î¼âˆ™ : ğ•Œ (â†‘ V) â†’ ğ•Œ V
  â‰ƒâˆ™ : ğ•Œ V â†’ ğ•Œ V â†’ ğ•Œ V

ğ•Œâ†’ : âˆ€ {V W : Set} â†’ (V â†’ W) â†’ ğ•Œ V â†’ ğ•Œ W
ğ•Œâ†’ f (ğ•âˆ™ v) = ğ•âˆ™ (f v)
ğ•Œâ†’ f âŠ¥âˆ™ = âŠ¥âˆ™
ğ•Œâ†’ f âŠ¤âˆ™ = âŠ¤âˆ™
ğ•Œâ†’ f (Ã—âˆ™ A B) = Ã—âˆ™ (ğ•Œâ†’ f A) (ğ•Œâ†’ f B)
ğ•Œâ†’ f (âŠ”âˆ™ A B) = âŠ”âˆ™ (ğ•Œâ†’ f A) (ğ•Œâ†’ f B)
ğ•Œâ†’ f (Î¼âˆ™ F) = Î¼âˆ™ (ğ•Œâ†’ (â†‘â†’ f) F )
ğ•Œâ†’ f (â‰ƒâˆ™ A B) = â‰ƒâˆ™ (ğ•Œâ†’ f A) (ğ•Œâ†’ f B)

Sub : Set â†’ Set â†’ Set
Sub V W = V â†’ ğ•Œ W

Subâ†‘ : âˆ€ {V W} â†’ Sub V W â†’ Sub (â†‘ V) (â†‘ W)
Subâ†‘ f = io (ğ•Œâ†’ i âˆ˜ f) (ğ•âˆ™ o)

_[_] : âˆ€ {V W : Set} â†’ ğ•Œ V â†’ Sub V W â†’ ğ•Œ W
ğ•âˆ™ x [ Ïƒ ] = Ïƒ x
âŠ¥âˆ™ [ Ïƒ ] = âŠ¥âˆ™
âŠ¤âˆ™ [ Ïƒ ] = âŠ¤âˆ™
Ã—âˆ™ A B [ Ïƒ ] = Ã—âˆ™ (A [ Ïƒ ]) (B [ Ïƒ ])
âŠ”âˆ™ A B [ Ïƒ ] = âŠ”âˆ™ (A [ Ïƒ ]) (B [ Ïƒ ])
Î¼âˆ™ F [ Ïƒ ]   = Î¼âˆ™ (F [ Subâ†‘ Ïƒ ])
â‰ƒâˆ™ A B [ Ïƒ ] = â‰ƒâˆ™ (A [ Ïƒ ]) (B [ Ïƒ ])

data ğ•Œ* {V : Set} : ğ•Œ V â†’ ğ•Œ V â†’ Set where
  ğ•* : âˆ€ v â†’ ğ•Œ* (ğ•âˆ™ v) (ğ•âˆ™ v)
  âŠ¥* : ğ•Œ* âŠ¥âˆ™ âŠ¥âˆ™
  âŠ¤* : ğ•Œ* âŠ¤âˆ™ âŠ¤âˆ™
  Ã—* : âˆ€ {A0 A1 : ğ•Œ V} (A* : ğ•Œ* A0 A1) {B0 B1 : ğ•Œ V} (B* : ğ•Œ* B0 B1) â†’ ğ•Œ* (Ã—âˆ™ A0 B0) (Ã—âˆ™ A1 B1)
  âŠ”* : âˆ€ {A0 A1 : ğ•Œ V} (A* : ğ•Œ* A0 A1) {B0 B1 : ğ•Œ V} (B* : ğ•Œ* B0 B1) â†’ ğ•Œ* (âŠ”âˆ™ A0 B0) (âŠ”âˆ™ A1 B1)
  â‰ƒ* : âˆ€ {A0 A1 : ğ•Œ V} (A* : ğ•Œ* A0 A1) {B0 B1 : ğ•Œ V} (B* : ğ•Œ* B0 B1) â†’ ğ•Œ* (â‰ƒâˆ™ A0 B0) (â‰ƒâˆ™ A1 B1)
  Î¼* : âˆ€ {F0 F1 : ğ•Œ (â†‘ V)} â†’ ğ•Œ* F0 F1 â†’ ğ•Œ* (Î¼âˆ™ F0) (Î¼âˆ™ F1) -- ??

ğ•Œ*â†’ : âˆ€ {V W : Set} (f : V â†’ W) {A B : ğ•Œ V} â†’ ğ•Œ* A B â†’ ğ•Œ* (ğ•Œâ†’ f A) (ğ•Œâ†’ f B)
ğ•Œ*â†’ f (ğ•* v) = ğ•* (f v)
ğ•Œ*â†’ f âŠ¥* = âŠ¥*
ğ•Œ*â†’ f âŠ¤* = âŠ¤*
ğ•Œ*â†’ f (Ã—* AB ABâ‚) = Ã—* (ğ•Œ*â†’ f AB) (ğ•Œ*â†’ f ABâ‚)
ğ•Œ*â†’ f (âŠ”* AB ABâ‚) = âŠ”* (ğ•Œ*â†’ f AB) (ğ•Œ*â†’ f ABâ‚)
ğ•Œ*â†’ f (â‰ƒ* AB ABâ‚) = â‰ƒ* (ğ•Œ*â†’ f AB) (ğ•Œ*â†’ f ABâ‚)
ğ•Œ*â†’ f (Î¼* AB) = Î¼* (ğ•Œ*â†’ (â†‘â†’ f) AB)

Sub* : âˆ€ {V W : Set} â†’ Rel (Sub V W) (Sub V W)
Sub* Ïƒ Ï„ = âˆ€ v â†’ ğ•Œ* (Ïƒ v) (Ï„ v)

Subâ†‘* : âˆ€ {V W : Set} {Ïƒ Ï„ : Sub V W} â†’ Sub* Ïƒ Ï„ â†’ Sub* (Subâ†‘ Ïƒ) (Subâ†‘ Ï„)
Subâ†‘* ÏƒÏ„ (i x) = ğ•Œ*â†’ i (ÏƒÏ„ x)
Subâ†‘* ÏƒÏ„ o = ğ•* o

_[_]* : âˆ€ {V W : Set} â†’ (A : ğ•Œ V) â†’ {Ïƒ Ï„ : Sub V W} â†’ (ÏƒÏ„ : Sub* Ïƒ Ï„) â†’ ğ•Œ* (A [ Ïƒ ]) (A [ Ï„ ])
ğ•âˆ™ x [ ÏƒÏ„ ]* = ÏƒÏ„ x
âŠ¥âˆ™ [ ÏƒÏ„ ]* = âŠ¥*
âŠ¤âˆ™ [ ÏƒÏ„ ]* = âŠ¤*
Ã—âˆ™ A B [ ÏƒÏ„ ]* = Ã—* (A [ ÏƒÏ„ ]*) (B [ ÏƒÏ„ ]*)
âŠ”âˆ™ A B [ ÏƒÏ„ ]* = âŠ”* (A [ ÏƒÏ„ ]*) (B [ ÏƒÏ„ ]*)
â‰ƒâˆ™ A B [ ÏƒÏ„ ]* = â‰ƒ* (A [ ÏƒÏ„ ]*) (B [ ÏƒÏ„ ]*)
Î¼âˆ™ F [ ÏƒÏ„ ]* = Î¼* (F [ Subâ†‘* ÏƒÏ„ ]*)

reflğ•Œ* : âˆ€ {V : Set} (A : ğ•Œ V) â†’ ğ•Œ* A A
reflğ•Œ* (ğ•âˆ™ x) = ğ•* x
reflğ•Œ* âŠ¥âˆ™ = âŠ¥*
reflğ•Œ* âŠ¤âˆ™ = âŠ¤*
reflğ•Œ* (Ã—âˆ™ A B) = Ã—* (reflğ•Œ* A) (reflğ•Œ* B)
reflğ•Œ* (âŠ”âˆ™ A B) = âŠ”* (reflğ•Œ* A) (reflğ•Œ* B)
reflğ•Œ* (â‰ƒâˆ™ A B) = â‰ƒ* (reflğ•Œ* A) (reflğ•Œ* B)
reflğ•Œ* (Î¼âˆ™ F) = Î¼* (reflğ•Œ* F)

ğ•Œ*[] : âˆ€ {V W : Set} (A B : ğ•Œ V) (Ïƒ : Sub V W) â†’ ğ•Œ* A B â†’ ğ•Œ* (A [ Ïƒ ]) (B [ Ïƒ ])
ğ•Œ*[] (ğ•âˆ™ v) (ğ•âˆ™ v) Ïƒ (ğ•* v) = reflğ•Œ* (Ïƒ v)
ğ•Œ*[] âŠ¥âˆ™ âŠ¥âˆ™ Ïƒ âŠ¥* = âŠ¥*
ğ•Œ*[] âŠ¤âˆ™ âŠ¤âˆ™ Ïƒ âŠ¤* = âŠ¤*
ğ•Œ*[] (Ã—âˆ™ A1 A2) (Ã—âˆ™ B1 B2) Ïƒ (Ã—* e1 e2) = Ã—* (ğ•Œ*[] A1 B1 Ïƒ e1) (ğ•Œ*[] A2 B2 Ïƒ e2)
ğ•Œ*[] (âŠ”âˆ™ A1 A2) (âŠ”âˆ™ B1 B2) Ïƒ (âŠ”* e1 e2) = âŠ”* (ğ•Œ*[] A1 B1 Ïƒ e1) (ğ•Œ*[] A2 B2 Ïƒ e2)
ğ•Œ*[] (â‰ƒâˆ™ A1 A2) (â‰ƒâˆ™ B1 B2) Ïƒ (â‰ƒ* e1 e2) = â‰ƒ* (ğ•Œ*[] A1 B1 Ïƒ e1) (ğ•Œ*[] A2 B2 Ïƒ e2)
ğ•Œ*[] (Î¼âˆ™ F1) (Î¼âˆ™ F2) Ïƒ (Î¼* e) = Î¼* (ğ•Œ*[] F1 F2 (Subâ†‘ Ïƒ) e)

idSub : âˆ€ {V W : Set} (Ïƒ : Sub V W) â†’ Sub* Ïƒ Ïƒ
idSub Ïƒ x = reflğ•Œ* (Ïƒ x)

record Cell (V : Set) : Set where
  constructor cell
  field
    src : ğ•Œ V
    tgt : ğ•Œ V
    eq : ğ•Œ* src tgt

Cellâ†’ : âˆ€ {V W} â†’ (V â†’ W) â†’ Cell V â†’ Cell W
Cellâ†’ f (cell src tgt eq) = cell (ğ•Œâ†’ f src) (ğ•Œâ†’ f tgt) (ğ•Œ*â†’ f eq)

open Cell

EqSub : Set â†’ Set â†’ Set
EqSub V W = V â†’ Cell W

EqSubâ†‘ : âˆ€ {V W : Set} â†’ EqSub V W â†’ EqSub (â†‘ V) (â†‘ W)
EqSubâ†‘ eqsub o = record { src = ğ•âˆ™ o ; tgt = ğ•âˆ™ o ; eq = ğ•* o }
EqSubâ†‘ eqsub (i x) = Cellâ†’ i (eqsub x)

_[_]Eq : âˆ€ {V W : Set} â†’ (A : ğ•Œ V) (Ïƒ* : EqSub V W) â†’ ğ•Œ* (A [ src âˆ˜ Ïƒ* ]) (A [ tgt âˆ˜ Ïƒ* ])
ğ•âˆ™ x [ Ïƒ* ]Eq = eq (Ïƒ* x)
âŠ¥âˆ™ [ Ïƒ* ]Eq = âŠ¥*
âŠ¤âˆ™ [ Ïƒ* ]Eq = âŠ¤*
Ã—âˆ™ A B [ Ïƒ* ]Eq = Ã—* (A [ Ïƒ* ]Eq) (B [ Ïƒ* ]Eq)
âŠ”âˆ™ A B [ Ïƒ* ]Eq = âŠ”* (A [ Ïƒ* ]Eq) (B [ Ïƒ* ]Eq)
Î¼âˆ™ A [ Ïƒ* ]Eq = Î¼* {! (A [ EqSubâ†‘ Ïƒ* ]Eq)  !}
â‰ƒâˆ™ A B [ Ïƒ* ]Eq = {!   !}

{-

SetEnv : Set â†’ Set
SetEnv V = V â†’ Set

âŸ¦_âŸ§ : âˆ€ {V} â†’ ğ•Œ V â†’ SetEnv V â†’ Set
âŸ¦ ğ•âˆ™ x âŸ§ Ï = Ï x
âŸ¦ âŠ¥âˆ™ âŸ§ Ï = âŠ¥
âŸ¦ âŠ¤âˆ™ âŸ§ Ï = âŠ¤
âŸ¦ Ã—âˆ™ A B âŸ§ Ï = âŸ¦ A âŸ§ Ï Ã— âŸ¦ B âŸ§ Ï
âŸ¦ âŠ”âˆ™ A B âŸ§ Ï = âŸ¦ A âŸ§ Ï âŠ” âŸ¦ B âŸ§ Ï
âŸ¦ â‰ƒâˆ™ A B âŸ§ Ï = ğ•Œ* A B
âŸ¦ Î¼âˆ™ F âŸ§ Ï = {!   !}

RelEnv : âˆ€ {V : Set} â†’ Rel (SetEnv V) (SetEnv V)
RelEnv {V} Ï0 Ï1 = âˆ€ v â†’ Rel (Ï0 v) (Ï1 v)

âŸ¦_âŸ§* : âˆ€ {V} {A B : ğ•Œ V} â†’ ğ•Œ* A B â†’ {Ï0 Ï1 : SetEnv V} (Ï* : RelEnv Ï0 Ï1)
           â†’ Rel (âŸ¦ A âŸ§ Ï0) (âŸ¦ B âŸ§ Ï1)
âŸ¦ ğ•* v âŸ§* Ï* = Ï* v
âŸ¦ âŠ¥* âŸ§* Ï* ()
âŸ¦ âŠ¤* âŸ§* Ï* _ _ = âŠ¤
âŸ¦ Ã—* A* B* âŸ§* Ï* (a0 , b0) (a1 , b1) = âŸ¦ A* âŸ§* Ï* a0 a1 Ã— âŸ¦ B* âŸ§* Ï* b0 b1
âŸ¦ âŠ”* A* B* âŸ§* Ï* (in1 a0) (in1 a1) = âŸ¦ A* âŸ§* Ï* a0 a1
âŸ¦ âŠ”* A* B* âŸ§* Ï* (in1 _) (in2 _) = âŠ¥
âŸ¦ âŠ”* A* B* âŸ§* Ï* (in2 _) (in1 _) = âŠ¥
âŸ¦ âŠ”* A* B* âŸ§* Ï* (in2 b0) (in2 b1) = âŸ¦ B* âŸ§* Ï* b0 b1
âŸ¦ â‰ƒ* A* B* âŸ§* Ï* i0 i1 = âˆ€ {x0} {y0} (xy0 : i0 x0 y0) {x1} {y1} (xy1 : i1 x1 y1)
                           â†’ Rel (âŸ¦ A* âŸ§* Ï* x0 x1) (âŸ¦ B* âŸ§* Ï* y0 y1)

-}

-- âŸ¦_âŸ§Rel : âˆ€ {V} (A : ğ•Œ V) {Ï0 Ï1 : SetEnv V}
--           â†’ RelEnv Ï0 Ï1 â†’ Rel (âŸ¦ A âŸ§Set Ï0) (âŸ¦ A âŸ§Set Ï1)
-- âŸ¦ ğ•âˆ™ x âŸ§Rel Ï* = Ï* x
-- âŸ¦ âŠ¥âˆ™ âŸ§Rel Ï* ()
-- âŸ¦ âŠ¤âˆ™ âŸ§Rel Ï* _ _ = âŠ¤
-- âŸ¦ Ã—âˆ™ A B âŸ§Rel Ï* (a0 , b0) (a1 , b1) = âŸ¦ A âŸ§Rel Ï* a0 a1 Ã— âŸ¦ B âŸ§Rel Ï* b0 b1
-- âŸ¦ âŠ”âˆ™ A B âŸ§Rel Ï* (in1 a0) (in1 a1) = âŸ¦ A âŸ§Rel Ï* a0 a1
-- âŸ¦ âŠ”âˆ™ A B âŸ§Rel Ï* (in1 _) (in2 _) = âŠ¥
-- âŸ¦ âŠ”âˆ™ A B âŸ§Rel Ï* (in2 _) (in1 _) = âŠ¥
-- âŸ¦ âŠ”âˆ™ A B âŸ§Rel Ï* (in2 b0) (in2 b1) = âŸ¦ B âŸ§Rel Ï* b0 b1
-- âŸ¦ â‰ƒâˆ™ A B âŸ§Rel Ï* i0 i1 =
--   âˆ€ {x0} {y0} (xy0 : i0 x0 y0) {x1} {y1} (xy1 : i1 x1 y1)
--     â†’ Rel (âŸ¦ A âŸ§Rel Ï* x0 x1) (âŸ¦ B âŸ§Rel Ï* y0 y1)

{-
âŸ¦_âŸ§*Setâ‚€ : âˆ€ {V} {A B : ğ•Œ V} â†’ ğ•Œ* A B â†’ (Ï : SetEnv V) â†’ Rel (âŸ¦ A âŸ§Set Ï) (âŸ¦ B âŸ§Set Ï)
âŸ¦ ğ•* v âŸ§*Setâ‚€ Ï = {!   !}
âŸ¦ âŠ¥* âŸ§*Setâ‚€ Ï = {!   !}
âŸ¦ âŠ¤* âŸ§*Setâ‚€ Ï = {!   !}
âŸ¦ Ã—* A Aâ‚ âŸ§*Setâ‚€ Ï = {!   !}
âŸ¦ âŠ”* A Aâ‚ âŸ§*Setâ‚€ Ï = {!   !}



âŸ¦_âŸ§*Sub : âˆ€ {V W : Set} {A B : ğ•Œ V} â†’ ğ•Œ* A B â†’ {Ï0 Ï1 : Sub V W} (Ï* : Sub* Ï0 Ï1) (Ïƒ : SetEnv W)
           â†’ Rel (âŸ¦ A [ Ï0 ] âŸ§Set Ïƒ) (âŸ¦ B [ Ï1 ] âŸ§Set Ïƒ)
âŸ¦ AB âŸ§*Sub Ï* Ïƒ = {! AB [ ]  !}

eq : âˆ€ {V : Set} (A : ğ•Œ V) {Ïƒ : SetEnv V} â†’ Rel (âŸ¦ A âŸ§Set Ïƒ) (âŸ¦ A âŸ§Set Ïƒ)
eq A {Ïƒ} = let
    Ağ•âˆ™ = A [ ğ•âˆ™ ]
    A[ğ•*] = A [ idSub ğ•âˆ™ ]*
    reflA = reflğ•Œ* A
    reflA* = âŸ¦ refl A âŸ§*Set (idSub ğ•Ì‡âˆ™)
  in ?


-- âŸ¦_âŸ§*Rel : âˆ€ {V} {A B : ğ•Œ V} (R : ğ•Œ* A B) â†’ {Ï0 Ï1 : SetEnv V} (Ï* : RelEnv Ï0 Ï1)
--            â†’ (e0 : SetEnvElem Ï0) (e1 : SetEnvElem Ï1)
--            â†’ RelEnvProof Ï* e0 e1 â†’ âŸ¦ R âŸ§*Set Ï* e0 e1

-- âŸ¦_âŸ§*Rel : âˆ€ {V} {A0 A1 : ğ•Œ V} (A* : ğ•Œ* A0 A1) â†’ {B0 B1 : ğ•Œ V} (B* : ğ•Œ* B0 B1)
--             â†’  ğ•Œ* A B â†’ (Ï : SetEnv V) â†’ Rel (âŸ¦ A âŸ§Set Ï) (âŸ¦ B âŸ§Set Ï)

SetEnvğ•Œ : âˆ€ V â†’ SetEnv V
SetEnvğ•Œ V = Î» v â†’ ğ•Œ V

RelEnvğ•Œ* : âˆ€ V â†’ RelEnv (SetEnvğ•Œ V) (SetEnvğ•Œ V)
RelEnvğ•Œ* V = Î» v â†’ ğ•Œ*

Tğ•Œâ° : âˆ€ (A : ğ•Œ âŠ¥) â†’ Rel (âŸ¦ A âŸ§Set âˆ…) (âŸ¦ A âŸ§Set âˆ…)
Tğ•Œâ° A = âŸ¦ A âŸ§Rel Î» ()

Tğ•Œ : âˆ€ {V} (A : ğ•Œ V) (Ï : SetEnv V) â†’ Rel (âŸ¦ A âŸ§Set Ï) (âŸ¦ A âŸ§Set Ï)
Tğ•Œ A Ï = {!   !}

-- Idğ•Œ Ï = ğ•Œ*
--
--
-- Eqğ•Œ : âˆ€ {V} â†’ Rel (ğ•Œ V) (ğ•Œ V)
-- Eqğ•Œ {V} = {!   !}

-- SetEnvElem : âˆ€ {V} â†’ SetEnv V â†’ Set
-- SetEnvElem {V} Ï = âˆ€ v â†’ Ï v
--
-- RelEnvProof : âˆ€ {V} {Ï0 Ï1 : SetEnv V} â†’ RelEnv Ï0 Ï1 â†’ SetEnvElem Ï0 â†’ SetEnvElem Ï1 â†’ Set
-- RelEnvProof {V} {Ï0} {Ï1} Ï* e0 e1 = âˆ€ (v : V) â†’ Ï* v (e0 v) (e1 v)






-- the end

-- âŸ¦_âŸ§*Set : âˆ€ {V} {A B : ğ•Œ V} â†’ ğ•Œ* A B â†’ (Ï : SetEnv V) (idÏ : RelEnv Ï Ï) â†’ Rel (âŸ¦ A âŸ§Set Ï) (âŸ¦ B âŸ§Set Ï)
-- âŸ¦ ğ•* v âŸ§*Set Ï a b = {!   !}
-- âŸ¦ âŠ¤* âŸ§*Set Ï a b = {!   !}
-- âŸ¦ Ã—* A* A*â‚ âŸ§*Set Ï a b = {!   !}
-- âŸ¦ âŠ”* A* A*â‚ âŸ§*Set Ï a b = {!   !}

-}
